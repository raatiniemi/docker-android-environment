#!/usr/bin/env bash
render_template() {
  echo '########################'
  echo '# Do not edit this file, it is generated from Dockerfile.template'
  echo '# using the `bin/generate-from-template` script.'
  echo '########################'
  sed -e "s/%%JAVA_VERSION%%/${1}/g" \
    -e "s/ %%ANDROID_API%%/${2}/g" \
    "Dockerfile.template"
}

for JAVA_VERSION in "8" "11"; do
  render_template "$JAVA_VERSION" >"jdk${JAVA_VERSION}/Dockerfile"

  for API_VERSION in "28" "29" "30"; do
    API_VERSION_DIRECTORY="jdk${JAVA_VERSION}/${API_VERSION}"
    if [ ! -d "${API_VERSION_DIRECTORY}" ]; then
      echo "Create directory for version: ${API_VERSION}"
      mkdir -p "${API_VERSION_DIRECTORY}"
    fi

    INSTALL_ANDROID_API="yes | sdkmanager \"platforms;android-${API_VERSION}\""
    render_template "$JAVA_VERSION" " \&\& ${INSTALL_ANDROID_API}" >"${API_VERSION_DIRECTORY}/Dockerfile"
  done
done
