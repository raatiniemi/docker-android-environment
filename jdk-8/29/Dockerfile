########################
# Do not edit this file, it is generated from Dockerfile.template
# using the `bin/generate-from-template` script.
########################
FROM openjdk:8-alpine AS builder
WORKDIR /build
ENV ANDROID_HOME /opt/android-sdk
ENV ANDROID_TOOLS_ZIP "sdk-tools-linux-4333796.zip"
RUN set -x \
  && apk -qU --no-cache add curl=7.64.0-r5 unzip=6.0-r6 ca-certificates=20191127-r2 \
  && curl -O -Ls "https://dl.google.com/android/repository/${ANDROID_TOOLS_ZIP}" \
  && unzip -qq "${ANDROID_TOOLS_ZIP}" -d "${ANDROID_HOME}" \
  && yes | "${ANDROID_HOME}/tools/bin/sdkmanager" --licenses >/dev/null \
  && "${ANDROID_HOME}/tools/bin/sdkmanager" "cmdline-tools;latest" \
  && rm -rf "${ANDROID_HOME}/tools"

FROM openjdk:8-slim-buster
LABEL maintainer="Tobias Raatiniemi <raatiniemi@gmail.com>"

ENV ANDROID_HOME /opt/android-sdk
ENV PATH $PATH:${ANDROID_HOME}/cmdline-tools/latest/bin

COPY --from=builder ${ANDROID_HOME} ${ANDROID_HOME}

RUN set -x && apt-get update -qq \
  && apt-cache madison git ssh curl unzip \
  && apt-get install -qq -y git=1:2.20.1-2+deb10u3 ssh=1:7.9p1-10+deb10u2 curl=7.64.0-4+deb10u2 unzip=6.0-23+deb10u2 libgnutls30=3.6.7-4+deb10u7 liblz4-1=1.8.3-1+deb10u1 libgcrypt20=1.8.4-5+deb10u1 libhogweed4=3.4.1-1+deb10u1 libnettle6=3.4.1-1+deb10u1 --no-install-recommends \
  && apt-get clean \
  && rm -rf /var/lib/apt/lists/* \
  && yes | sdkmanager --licenses >/dev/null \
  && sdkmanager platform-tools && yes | sdkmanager "platforms;android-29"
